import{useState as n,useEffect as t,useRef as e}from"react";import r from"@use-it/event-listener";var u={},o=function(n,t,e){return u[n]||(u[n]={callbacks:[],value:e}),u[n].callbacks.push(t),{deregister:function(){var e=u[n].callbacks,r=e.indexOf(t);r>-1&&e.splice(r,1)},emit:function(e){u[n].value!==e&&(u[n].value=e,u[n].callbacks.forEach(function(n){t!==n&&n(e)}))}}};export default function(u,c){if(void 0===c&&(c=global.localStorage),c){var i=function(n){return{get:function(t,e){var r=n.getItem(t);return console.log(r),null===r||"string"!=typeof r?"function"==typeof e?e():e:JSON.parse(r)},set:function(t,e){n.setItem(t,JSON.stringify(e))}}}(c);return function(c){return function(u,c,i){var a=i.get,l=i.set,f=e(null),s=n(function(){return a(c,u)}),g=s[0],v=s[1];return r("storage",function(n){var t=n.newValue;if(n.key===c){console.log(t);var e=JSON.parse(t);g!==e&&v(e)}}),t(function(){return f.current=o(c,v,u),function(){f.current.deregister()}},[]),t(function(){l(c,g),f.current.emit(g)},[g]),[g,v]}(c,u,i)}}return n}
