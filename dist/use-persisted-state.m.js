import{useState as t,useEffect as n,useRef as e}from"react";import r from"@use-it/event-listener";var u={},i=function(t,n,e){return u[t]||(u[t]={callbacks:[],value:e}),u[t].callbacks.push(n),{deregister:function(){var e=u[t].callbacks,r=e.indexOf(n);r>-1&&e.splice(r,1)},emit:function(e){u[t].value!==e&&(u[t].value=e,u[t].callbacks.forEach(function(t){n!==t&&t(e)}))}}};export default function(u,c){if(void 0===c&&(c=global.localStorage),c){var o=function(t){return{get:function(n,e){var r=t.getItem(n);return null===r||"string"!=typeof r?"function"==typeof e?e():e:JSON.parse(r)},set:function(n,e){t.setItem(n,JSON.stringify(e))}}}(c);return function(c){return function(u,c,o){var a=o.get,f=o.set,l=e(null),s=t(function(){return a(c,u)}),v=s[0],g=s[1];return r("storage",function(t){if(t.key===c){var n=JSON.parse(t.newValue);v!==n&&g(n)}}),n(function(){return l.current=i(c,g,u),function(){l.current.deregister()}},[]),n(function(){f(c,v),l.current.emit(v)},[v]),[v,g]}(c,u,o)}}return t}
